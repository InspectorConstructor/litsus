<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ADMIN (SUS or LIT)</title>
    <!-- style -->
    <link rel="stylesheet" href="css/base-min.css">
    <link rel="stylesheet" href="css/pure-min.css">
    <!-- script libraries -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- application script -->
    <script>

      // define callbacks for socket event(s) //
      var  state, //todo
           votes, //todo
           current_track='',
           websocket_server_address=window.location.href,
           limiter={
              limit: function(){}
           },

          win_semantics = {
              top: 100,
              top_en: true,

              spread: 60,
              spread_en: false
          };

      /***
        sus/lit votes object: (not final)

          pos: integer between -100 and 100, inclusive. represents the weight of all current votes in room.
          num: positive integer. represents the total number of votes.

      ***/

      // updates the votes meter based on the update message from server.
      function update_votes(data){
          $('#numlit').text(data.lit);
          $('#numsus').text(data.sus);
          $('#winner').text(data.win);
      }

      function do_reset(){
          console.log('sending reset');
          socket.emit('reset');
      }

      function do_send_text(){
          console.log('sending title');
          socket.emit('title', $('#song_name').val());
      }

      function start_next_vote(){
          console.log('Starting next vote with title');
          socket.emit('next_vote', $('#song_name').val());
          // todo message to user. $('#song_name').val());
      }

      function do_win(){
          var w;
          w.top = $('#top').val();
          w.top_en = $('#top_en').checked();
          w.spread = $('#spread').val();
          w.spread_en = $('#spread_en').checked();

          console.log('sending win_semantics object');
          socket.emit('win_semantics', w);
      }

      function do_disable(){
          console.log('sending disable');
          socket.emit('disable');
      }

      function do_enable(){
          console.log('sending enable');
          socket.emit('enable');
      }

      // function to send a vote to the server.
      function vote(sus_or_lit){
          if (sus_or_lit === 'sus' || sus_or_lit === 'lit')
              socket.emit('vote', {id: my_id, its: sus_or_lit});
          else
              console.warn("unexpected vote cast:", sus_or_lit);
      }

      // set up our socket //

      var socket = io(websocket_server_address);

      // set some callbacks for the socket.
      socket.on('init', function (data) {
          console.log('got init!! server state follows:');
          console.log(data);
          socket.emit('ok');
      });

      socket.on('votes', function (data) { // receive current voting status
          console.log('Got vote status:');
          console.log(data);
          update_votes(data);
      });


      // jquery's on-ready function thinger: runs the anonymous function when 
      // the page's DOM has been initialized and readied.
      $(function(){
          $('#send_text_btn').click(function(){
              console.log('send_text pressed');
              do_send_text();
          });
          $('#start_vote_btn').click(function(){
              console.log('start_vote_btn pressed');
              start_next_vote();
          });
          $('#win_btn').click(function(){
              console.log('win pressed');
              do_win();
          });
          $('#enable_btn').click(function(){
              console.log('enable pressed');
              do_enable();
          });
          $('#disable_btn').click(function(){
              console.log('disable pressed');
              do_disable();
          });
          $('#reset_btn').click(function(){
              console.log('reset pressed');
              do_reset();
          });
      });

    </script>
    <style>
      .cooper {
          font-family: Cooper Black, Arial Black, Sans-Serif;
      }

      #buttons_div {
          border: 3px solid gray;
          border-radius:7px;
          padding: 8px;
          display:inline;

      }

      #buttons_div * {
          font-weight: bold;
      }

      #song_name {
          min-width: 250px;
      }
    </style>
  </head>
  <body class="cooper">
    <h1>litsus Admin Panel</h1>
    <div id="buttons_div">
      <input placeholder="Song title goes here" type="text" id="song_name">
      <button class="pure-button" id="start_vote_btn">Start Vote</button>
      <button class="pure-button" id="send_text_btn">Fix misspelled title</button>
      <!-- div class="old_controls">
	<button class="pure-button" id="send_text_btn">UPDATE TRACK TEXT</button>
	<button class="pure-button" id="enable_btn">ENABLE VOTING</button>
	<button class="pure-button" id="disable_btn">DISABLE VOTING</button>
	<button class="pure-button" id="reset_btn">RESET SCORE</button>
      </div -->
    </div>
    <br/>
    <!--div class="unused_vote controls">
      <label for="top_en">Top enable</label>
      <input type="checkbox" id="top_en" checked>
      <label for="top">Top vote count</label>
      <input type="number" min="1" id="top" value="100">
      <br/>
      <label for="spread_en">Spread enable</label>
      <input type="checkbox" id="spread_en">
      <label for="spread">Spread count</label>
      <input type="number" min="1" id="spread" value="60">
      <br/>
      <button class="pure-button" id="win_btn">UPDATE WIN SEMANTICS</button>
    </div-->
    <div id="votes_div">
      <h2>Voting status</h2>
      <p>LIT  <span id="numlit" /> </p>
      <p>SUS  <span id="numsus" /> </p>
      <p>WIN  <span id="winner" /> </p>
    </div>
  </body>
</html>
